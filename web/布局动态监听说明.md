# å¸ƒå±€åŠ¨æ€ç›‘å¬ç³»ç»Ÿè¯´æ˜

## ğŸ“Œ å¿«é€Ÿå¼€å§‹

### è„šæœ¬è·å–UIçŠ¶æ€

```python
import requests

# è·å–å½“å‰UIçŠ¶æ€
response = requests.get('http://localhost:8000/api/ui/state')
data = response.json()

print(data['current_state'])
# è¾“å‡º: {'dashboard_active': True, 'current_tool': 'budget-planner', 'layout_mode': 'three-column'}
```

### è„šæœ¬æ§åˆ¶UIå¸ƒå±€

```python
import requests

# æ‰“å¼€å·¥å…·ï¼ˆä¸‰æ å¸ƒå±€ï¼‰
requests.post('http://localhost:8000/api/ui/command', json={
    "command": "open_dashboard",
    "params": {"tool": "budget-planner"}
})

# å…³é—­å·¥å…·ï¼ˆæ¢å¤äºŒæ ï¼‰
requests.post('http://localhost:8000/api/ui/command', json={
    "command": "close_dashboard",
    "params": {}
})
```

---

## ğŸ¨ ä¸¤ç§å¸ƒå±€æ¨¡å¼

### äºŒæ å¸ƒå±€ï¼ˆé»˜è®¤ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sidebar   â”‚      Chat Container          â”‚
â”‚  (280px)   â”‚      (flex: 1)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰æ å¸ƒå±€ï¼ˆå·¥å…·æ¿€æ´»ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sidebar   â”‚  Dashboard Panel â”‚  Chat Container  â”‚
â”‚  (280px)   â”‚  (flex: 1)       â”‚  (400px)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ ¸å¿ƒæœºåˆ¶ï¼šæ¥æºæ ‡è®°

ç³»ç»Ÿé€šè¿‡ `source` æ ‡è®°åŒºåˆ†çŠ¶æ€å˜æ›´æ¥æºï¼Œé¿å…é‡å¤æ‰§è¡Œï¼š

```
çŠ¶æ€å˜æ›´
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¥æºæ ‡è®°ï¼Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  source: "frontend"               â”‚
â”‚  â†’ ç”¨æˆ·ç‚¹å‡»æŒ‰é’®                   â”‚
â”‚  â†’ å‰ç«¯ç«‹å³åˆ‡æ¢ï¼ˆ0msï¼‰            â”‚
â”‚  â†’ åŒæ­¥çŠ¶æ€åˆ°åç«¯                 â”‚
â”‚  â†’ åç«¯åªè®°å½•ï¼Œä¸ç”Ÿæˆå‘½ä»¤ âœ…      â”‚
â”‚  â†’ è½®è¯¢å™¨ä¸ä¼šé‡å¤æ‰§è¡Œ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  source: "backend"                â”‚
â”‚  â†’ Agent/è„šæœ¬å‘é€å‘½ä»¤             â”‚
â”‚  â†’ åç«¯ç”Ÿæˆå‘½ä»¤åˆ°é˜Ÿåˆ—             â”‚
â”‚  â†’ å‰ç«¯è½®è¯¢è·å–å¹¶æ‰§è¡Œ             â”‚
â”‚  â†’ æ‰§è¡ŒååŒæ­¥çŠ¶æ€ï¼ˆfrontendï¼‰âœ…   â”‚
â”‚  â†’ ä¸ä¼šå†æ¬¡ç”Ÿæˆå‘½ä»¤               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ APIæ¥å£

### 1. GET /api/ui/state
è·å–UIçŠ¶æ€å’Œå¾…æ‰§è¡Œå‘½ä»¤ï¼ˆå‰ç«¯æ¯2ç§’è½®è¯¢ï¼‰

**å“åº”ï¼š**
```json
{
  "pending_commands": [
    {
      "command": "open_dashboard",
      "params": {"tool": "budget-planner"},
      "command_id": "cmd_xxx",
      "source": "backend"
    }
  ],
  "current_state": {
    "dashboard_active": false,
    "current_tool": null,
    "layout_mode": "two-column"
  }
}
```

---

### 2. POST /api/ui/command
Agent/è„šæœ¬å‘é€UIæ§åˆ¶å‘½ä»¤ï¼ˆsource: backendï¼‰

**è¯·æ±‚ï¼š**
```json
{
  "command": "open_dashboard",
  "params": {"tool": "budget-planner"}
}
```

**æ”¯æŒçš„å‘½ä»¤ï¼š**
- `open_dashboard` - æ‰“å¼€å·¥å…·ï¼ˆä¸‰æ ï¼‰
- `close_dashboard` - å…³é—­å·¥å…·ï¼ˆäºŒæ ï¼‰
- `switch_session` - åˆ‡æ¢ä¼šè¯

**å“åº”ï¼š**
```json
{
  "success": true,
  "command_id": "cmd_20251024_120000_abc123",
  "source": "backend"
}
```

---

### 3. POST /api/ui/state/sync
å‰ç«¯åŒæ­¥çŠ¶æ€åˆ°åç«¯ï¼ˆsource: frontendï¼‰

**è¯·æ±‚ï¼š**
```json
{
  "dashboard_active": true,
  "current_tool": "budget-planner",
  "layout_mode": "three-column",
  "source": "frontend"
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "State synced (no command generated)",
  "current_state": {...}
}
```

---

## ğŸ” å®Œæ•´æµç¨‹å›¾

### ç”¨æˆ·ç‚¹å‡»æŒ‰é’®

```
ç”¨æˆ·ç‚¹å‡»æŒ‰é’®
    â†“
å‰ç«¯ç«‹å³åˆ‡æ¢å¸ƒå±€ï¼ˆ0msï¼‰
    â†“
POST /api/ui/state/sync {source: "frontend"}
    â†“
åç«¯æ›´æ–°çŠ¶æ€ï¼Œä¸ç”Ÿæˆå‘½ä»¤
    â†“
å®Œæˆï¼ˆä¸ä¼šé‡å¤æ‰§è¡Œï¼‰
```

### Agentæ§åˆ¶UI

```
Agentå‘é€å‘½ä»¤
    â†“
POST /api/ui/command {source: "backend"}
    â†“
åç«¯ç”Ÿæˆå‘½ä»¤åˆ°é˜Ÿåˆ— + æ›´æ–°çŠ¶æ€
    â†“
å‰ç«¯è½®è¯¢è·å–å‘½ä»¤ï¼ˆ2ç§’å†…ï¼‰
    â†“
å‰ç«¯æ‰§è¡Œåˆ‡æ¢
    â†“
POST /api/ui/state/sync {source: "frontend"}
    â†“
åç«¯æ›´æ–°çŠ¶æ€ï¼Œä¸ç”Ÿæˆæ–°å‘½ä»¤
    â†“
å®Œæˆ
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### Python Agentç¤ºä¾‹

```python
import requests

BASE_URL = "http://localhost:8000"

class UIController:
    def __init__(self):
        self.base_url = BASE_URL
    
    def get_state(self):
        """è·å–å½“å‰UIçŠ¶æ€"""
        response = requests.get(f"{self.base_url}/api/ui/state")
        return response.json()['current_state']
    
    def open_tool(self, tool_name):
        """æ‰“å¼€å·¥å…·"""
        requests.post(f"{self.base_url}/api/ui/command", json={
            "command": "open_dashboard",
            "params": {"tool": tool_name}
        })
    
    def close_tool(self):
        """å…³é—­å·¥å…·"""
        requests.post(f"{self.base_url}/api/ui/command", json={
            "command": "close_dashboard",
            "params": {}
        })

# ä½¿ç”¨
ui = UIController()

# æ£€æŸ¥çŠ¶æ€
state = ui.get_state()
if not state['dashboard_active']:
    ui.open_tool('budget-planner')
```

### æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•

```javascript
// æŸ¥çœ‹å½“å‰çŠ¶æ€
fetch('/api/ui/state').then(r => r.json()).then(console.log)

// Agentæ–¹å¼ï¼šå‘é€å‘½ä»¤ï¼ˆé€šè¿‡é˜Ÿåˆ—ï¼‰
fetch('/api/ui/command', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        command: 'open_dashboard',
        params: {tool: 'spending-analyzer'}
    })
}).then(r => r.json()).then(console.log)

// å‰ç«¯æ–¹å¼ï¼šç›´æ¥ç‚¹å‡»æŒ‰é’®ï¼ˆç«‹å³æ‰§è¡Œï¼‰
sendButtonEvent('budget-planner')
```

---

## ğŸ¯ å…³é”®ä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **0å»¶è¿Ÿå“åº”** | ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ç«‹å³åˆ‡æ¢ï¼Œæ— éœ€ç­‰å¾… |
| **æ— é‡å¤æ‰§è¡Œ** | é€šè¿‡sourceæ ‡è®°é¿å…é‡å¤ |
| **çŠ¶æ€ä¸€è‡´** | å‰åç«¯çŠ¶æ€å®æ—¶åŒæ­¥ |
| **Agentå‹å¥½** | ä»»ä½•è„šæœ¬éƒ½èƒ½æ§åˆ¶UI |
| **ç®€å•æ¶æ„** | HTTPè½®è¯¢ï¼Œæ— éœ€WebSocket |

---

## ğŸ”§ é…ç½®

### è½®è¯¢é¢‘ç‡

ä¿®æ”¹ `web/index.html`:
```javascript
const UI_POLL_INTERVAL = 2000;  // 2ç§’ï¼ˆé»˜è®¤ï¼‰
```

### æŒä¹…åŒ–

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Rediså­˜å‚¨UIçŠ¶æ€ï¼š
```python
import redis
redis_client = redis.Redis()

# å­˜å‚¨
redis_client.set('ui_state', json.dumps(current_ui_state))

# è¯»å–
current_ui_state = json.loads(redis_client.get('ui_state'))
```

---

## ğŸ› è°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—

æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼š
```
ğŸ”˜ Button Clicked: budget-planner
âœ… Switched to: budget-planner
âœ… State synced to backend

// Agentè§¦å‘æ—¶
ğŸ¯ New UI Command Received: {...}
âš¡ Executing Command: open_dashboard
âœ… Dashboard Opened: budget-planner
âœ… State synced to backend
```

### æŸ¥çœ‹çŠ¶æ€

```bash
# å‘½ä»¤è¡ŒæŸ¥è¯¢
curl http://localhost:8000/api/ui/state | jq .current_state
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **APIè¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ `web/index.html` å¼€å¤´æ³¨é‡Š
- **åç«¯å®ç°**: `server/main.py` - UIæ§åˆ¶ç³»ç»Ÿéƒ¨åˆ†
- **å‰ç«¯å®ç°**: `web/index.html` - UI Dynamic Control System

---

**ç‰ˆæœ¬**: v2.0 - åŸºäºæ¥æºæ ‡è®°çš„æ™ºèƒ½çŠ¶æ€ç®¡ç†
